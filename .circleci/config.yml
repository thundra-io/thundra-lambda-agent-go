version: 2
jobs:
  build:
    docker:
      - image: circleci/golang:1.9

      - image: postgres:latest
        environment:
          - POSTGRES_PASSWORD=userpass
          - POSTGRES_USER=user
          - POSTGRES_DB=db
        ports:
          - '127.0.0.1:5432:5432'

      - image: mysql:5.7
        environment:
          - MYSQL_ROOT_PASSWORD=rootpass
          - MYSQL_PASSWORD=userpass
          - MYSQL_USER=user
          - MYSQL_DATABASE=db
        ports:
          - "127.0.0.1:3306:3306"

      - image: redis:4.0-alpine
        ports:
          - "127.0.0.1:6379:6379"

    working_directory: /go/src/github.com/thundra-io/thundra-lambda-agent-go
    steps:
      - checkout
      - run: go get -v -t -d ./...
      - run: go test -v ./...